<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>candy</title>
	<!-- Favicon -->
	<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
	<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
	<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  
	<style>
    body { 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      height: 100vh; 
      background: #fffaf0;
      font-family: sans-serif;
      flex-direction: column;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 70px);
      gap: 12px;
    }
    .bean {
      width: 60px;
      height: 40px;
      /* ä¸è¦å‰‡ãªä¸¸ã¿ */
      border-radius: 60% 40% 70% 30% / 40% 70% 30% 60%;
      /*background-size: cover;*/
			-webkit-tap-highlight-color: transparent;
      cursor: pointer;
      transition: transform 0.2s, opacity 0.3s;
      box-shadow: inset -3px -3px 6px rgba(0,0,0,0.15),
      						2px 2px 5px rgba(0,0,0,0.25);
    }
    .popped {
      transform: scale(0.8);
      opacity: 0.6;
      box-shadow: none;
    }
    #message {
      margin-top: 20px;
      font-size: 1.2em;
      color: #333;
    }
		/* æŠ¼ã—ãŸã¨ãã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
		@keyframes spinPop {
  		0% {
    			transform: scale(1) rotate(0deg);
    			opacity: 1;
  		}
  		70% {
    			transform: scale(1.2) rotate(360deg);
    			opacity: 1;
  		}
  		100% {
    			transform: scale(0) rotate(720deg);
    			opacity: 0;
  		}
		}

		.bean.popped {
  			animation: spinPop 0.6s ease-out forwards;
  			box-shadow: none;
		}

		.particle {
  			position: absolute;
  			width: 10px;
  			height: 10px;
  			border-radius: 50%;
  			pointer-events: none;
		}

		/*ãƒ•ãƒ«ãƒ¼ãƒ„ã‚·ãƒ£ãƒ¯ãƒ¼*/
		@keyframes fruitBurst {
  		0% {
    			transform: translate(0, 0) scale(0.8) rotate(0deg); /* å°ã•ãæº–å‚™ */
    			opacity: 1;
  				}
  		100% {
    			transform: translate(var(--x), var(--y)) scale(1) rotate(720deg); /* ä¸€æ°—ã«é£›ã³æ•£ã‚‹ */
    			opacity: 0;
  				}
		}	
		.fruit-piece {
  				position: absolute;
  				width: 32px;
  				height: 32px;
  				background-size: cover;
  				pointer-events: none;
  				animation: fruitBurst 1.5s ease-out forwards;
		}

		/* ä¸‹ä¸­å¤®ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ */
		#menu-bar {
  				display: flex;
  				gap: 12px;
  				justify-content: center;
  				align-items: center;
  				padding: 10px;
  				background: rgba(0,0,0,0.5);
  				border-radius: 12px;
  				/*position: fixed;
  				bottom: 20px;
  				left: 50%;
  				transform: translateX(-50%);*/
  				opacity: 0;
  				transition: opacity 1s ease;
					position: relative;   /* fixedãƒ»absolute ã‚’ã‚„ã‚ã‚‹ */
  				width: fit-content;   /* ä¸­èº«ã«åˆã‚ã›ã‚‹ */
					margin: 20px auto 0;  /* ä¸­å¤®å¯„ã› */
  				text-align: center;
		}
		#menu-bar.show {
  				opacity: 0.8;
		}
		#menu-bar button {
  				padding: 8px 14px;
  				border: none;
  				border-radius: 8px;
  				background: #fff;
  				font-size: 1em;
  				cursor: pointer;
					-webkit-tap-highlight-color: transparent;
		}
		/* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆç”¨ */
		.fade-out {
  				opacity: 0;
  				transition: opacity 1s;
		}

		/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
		@media (max-width: 600px) {
  		.grid {
    			grid-template-columns: repeat(4, 60px); /* å°‘ã—å°ã•ã‚ */
    			gap: 8px; /* é–“éš”ã‚‚ç‹­ã‚ã‚‹ */
  		}
  		.bean {
    			width: 52px;
    			height: 36px; /* æŠ¼ã—ã‚„ã™ã•ã‚’ã‚­ãƒ¼ãƒ— */
  		}
		}

  </style>
</head>
<body>
  <div class="grid" id="grid"></div>
  <div id="message"></div>
	
	<div id="menu-bar">
  <button id="restart-btn">â†» ã‚‚ã†ä¸€å›ï¼</button>
  <button id="menu-btn">âŒ‚ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸</button>
	</div>

  <audio id="pop-sound" src="puchi42.mp3"></audio>
	<audio id="special-sound" src="puchi41.mp3"></audio>

  <script>
    const grid = document.getElementById('grid');
    const message = document.getElementById('message');
    const sound = document.getElementById('pop-sound');
		const specialSound = document.getElementById('special-sound');
    const totalBeans = 16;

		const restartBtn = document.getElementById("restart-btn");
		const menuBtn = document.getElementById("menu-btn");

		const events = ["click", "touchend"];
		// restartBtn ã«å¯¾ã—ã¦
		events.forEach(evt => {
  		restartBtn.addEventListener(evt, () => window.location.reload());
		});
		// menuBtn ã«å¯¾ã—ã¦
		events.forEach(evt => {
  		menuBtn.addEventListener(evt, () => window.location.href = "index.html");
		});

    // ãƒ‘ã‚¹ãƒ†ãƒ«èª¿ã®ã‚«ãƒ©ãƒ¼ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³
    const colors = [
      "linear-gradient(45deg, #ffcccc, #ff9999)", // ãƒ”ãƒ³ã‚¯
      "linear-gradient(45deg, #ccffcc, #99ff99)", // ç·‘
      "linear-gradient(45deg, #ccccff, #9999ff)", // é’
      "linear-gradient(45deg, #fff5cc, #ffdd99)", // é»„
      "linear-gradient(45deg, #ffd9cc, #ffb399)"  // ã‚ªãƒ¬ãƒ³ã‚¸
    ];

		// ã·ã¡ç”Ÿæˆ
		for (let i = 0; i < totalBeans; i++) {
  		const bean = document.createElement('div');
  		bean.classList.add('bean');

  	// ãƒ©ãƒ³ãƒ€ãƒ ãªè‰²ã‚’è¨­å®š
  		const randomColor = colors[Math.floor(Math.random() * colors.length)];
  		bean.style.background = randomColor;

  	// ã‚¯ãƒªãƒƒã‚¯ï¼ã‚¿ãƒƒãƒã§æ½°ã‚Œã‚‹å‡¦ç†
  		const popBean = (e) => {
    		/*if (e.type === 'touchstart') {
      		e.preventDefault(); // ã‚¿ãƒƒãƒ—å¾Œã®clickç™ºç«ã‚’é˜²ã
    		}*/

    		if (!bean.classList.contains('popped')) {
      		bean.classList.add('popped');

    		// æ®‹ã‚Šã®æœªãƒ—ãƒè¦ç´ ã‚’ãƒã‚§ãƒƒã‚¯
      		const remaining = document.querySelectorAll('.bean:not(.popped)').length;

      	if (remaining === 0) {
        // æœ€å¾Œã®1å€‹  ãƒ•ãƒ«ãƒ¼ãƒ„é£›ã°ã™ & ç‰¹åˆ¥éŸ³
        	specialSound.currentTime = 0;
        	specialSound.play();
				// ãƒ—ãƒã®ä¸­å¤®
        	const rect = bean.getBoundingClientRect();
        	const startX = rect.left + rect.width / 2;
        	const startY = rect.top + rect.height / 2;

        	createFruitShower(document.body, ["orange.png", "suika.png", "lemon.png", "kodama.png"], startX, startY);
        	message.textContent = "ãƒ•ãƒ«ãƒ¼ãƒ„ã‚·ãƒ£ãƒ¯ãƒ¼ï¼ğŸŠğŸ‰âœ¨";

        // 3ç§’å¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
        	setTimeout(() => {
          	message.classList.add("fade-out");
				// ã•ã‚‰ã«1ç§’å¾Œã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼è¡¨ç¤º
          	setTimeout(() => {
            	document.getElementById("menu-bar").classList.add("show");
          		}, 1000);
        		}, 3000);

      		} else {
        // é€šå¸¸ ã‚«ãƒ©ãƒ•ãƒ«ä¸¸ç²’ & æ™®é€šã®éŸ³ã€€special=falseã¯æ‹¡å¼µç”¨
        		sound.currentTime = 0;
        		sound.play();
        		const rect = bean.getBoundingClientRect();
        		createParticles(rect.left + rect.width / 2, rect.top + rect.height / 2, false);
      			}
    			}
  			};

  		bean.addEventListener('click', popBean);
  		bean.addEventListener('touchend', popBean);
  		grid.appendChild(bean);
		}

		function createParticles(x, y, special = false) {
  		const pcolors = ["#ff7f7f", "#7fbfff", "#7fff7f", "#fff27f", "#ff7fff"];
  		
  		for (let i = 0; i < 6; i++) {
    		const particle = document.createElement("div");
				particle.classList.add("particle");
    		particle.style.left = x + "px";
    		particle.style.top = y + "px";			
      	particle.style.background = pcolors[Math.floor(Math.random() * pcolors.length)];

   		// ãƒ©ãƒ³ãƒ€ãƒ æ–¹å‘ã«é£›ã°ã™
    		const angle = Math.random() * 2 * Math.PI;
    		const distance = 40 + Math.random() * 20;
    		const dx = Math.cos(angle) * distance;
    		const dy = Math.sin(angle) * distance;

    		particle.style.transform = `translate(${dx}px, ${dy}px)`;
    		particle.style.transition = "transform 0.6s ease-out, opacity 0.6s ease-out";
    		document.body.appendChild(particle);

    	// çµ‚äº†å¾Œã«å‰Šé™¤
    		setTimeout(() => {
      	particle.style.opacity = "0";
      	setTimeout(() => particle.remove(), 600);
    		}, 0);
  		}
		}

		function createFruitShower(container, fruitImages, startX, startY) {
  		for (let i = 0; i < 25; i++) {
    		const piece = document.createElement("div");
    		piece.className = "fruit-piece";

    	// ãƒ©ãƒ³ãƒ€ãƒ ãƒ•ãƒ«ãƒ¼ãƒ„
    		const img = fruitImages[Math.floor(Math.random() * fruitImages.length)];
    		piece.style.backgroundImage = `url(${img})`;

			// åˆæœŸä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯ä½ç½®ã«ã‚»ãƒƒãƒˆ
    		piece.style.left = startX + "px";
    		piece.style.top = startY + "px";

    	// ãƒ©ãƒ³ãƒ€ãƒ é£›æ•£æ–¹å‘
    		const angle = Math.random() * 2 * Math.PI;
    		const distance = 300 + Math.random() * 300; // 300ã€œ600px
    		const x = Math.cos(angle) * distance;
    		const y = Math.sin(angle) * distance;

    		piece.style.setProperty("--x", `${x}px`);
    		piece.style.setProperty("--y", `${y}px`);

    	// ãƒ©ãƒ³ãƒ€ãƒ ãƒ‡ã‚£ãƒ¬ã‚¤
    		piece.style.animationDelay = `${Math.random()}s`;

    		container.appendChild(piece);

    	// çµ‚äº†å¾Œã«å‰Šé™¤
    		setTimeout(() => piece.remove(), 3000);
  		}
		}
		
  </script>
</body>
<footer style="text-align:center; margin-top:40px; padding:10px; font-size:0.9em; color:#aaa;">
  &copy; 2025 Choco's candy<span style="opacity:0.4;">ğŸ¬</span>
</footer>
</html>