<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>clover</title>
	<!-- Favicon -->
	<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
	<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
	<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

  <style>
    body { 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      height: 100vh; 
      background: linear-gradient(to bottom, #001028, #00334d); /* å¤œè‰²ã‚¹ã‚¿ãƒ¼ãƒˆ */
      font-family: sans-serif;
      flex-direction: column;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 60px);
      gap: 10px;
    }    
		.bubble {
  		width: 60px;
  		height: 60px;
  		border-radius: 50%;
  		background: radial-gradient(circle at 30% 30%,
    	rgba(255, 255, 255, 0.9),
    	rgba(180, 200, 255, 0.25));/*0.15*/
			-webkit-backdrop-filter: blur(2px);	
			backdrop-filter: blur(2px); /* é€æ˜æ„Ÿã‚¢ãƒƒãƒ—ï¼ˆå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã§ï¼‰ */
			-webkit-tap-highlight-color: transparent;
  		box-shadow:
    	inset -3px -3px 6px rgba(255,255,255,0.6), /* ä¸Šã‹ã‚‰å…‰ */
    	3px 3px 6px rgba(0,0,0,0.4);              /* ä¸‹ã«å½± */
			cursor: pointer;
  		transition: transform 0.2s, opacity 0.3s;			
		}
    .popped {
      background:transparent;
      box-shadow: none;
    }
    #message {
      margin-top: 20px;
      font-size: 1.2em;
      color: #333;
    }
		
		.splash {
  		position: absolute;
			background: radial-gradient(circle, rgba(173, 216, 230, 0.9), rgba(173, 216, 230, 0));
  		border-radius: 50%;
			pointer-events: none;
  		animation: splashMove 1.2s ease-out forwards;
		} 
		/* æ”¾ç‰©ç·šã£ã½ã */
		@keyframes splashMove {
  		0% {
    			transform: translate(0, 0) scale(1);
    			opacity: 1;
  			}
  		30% {
    			transform: translate(calc(var(--x) * 0.6), calc(var(--y) * 0.3)) scale(1.35);
    			opacity: 0.9; /*40%*/
  			}
  		100% {
    			transform: translate(var(--x), var(--y)) scale(0.7);
    			opacity: 0;
  			}
		}

		/* æœ€å¾Œã®ã‚­ãƒ©ãƒƒ*/
		.shine {
  				position: absolute;
  				width: 30px;
  				height: 30px;
  				pointer-events: none;
  				background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, transparent 70%);
  				border-radius: 50%;
  				opacity: 0;
  				transform: scale(0.5);
  				animation: shineEffect 1s ease-out forwards;
		}
		@keyframes shineEffect {
  		0% {
    			opacity: 0.8;
    			transform: scale(0.5);
  			}
  		50% {
    			opacity: 1;
    			transform: scale(1.5);
  			}
  		100% {
    			opacity: 0;
    			transform: scale(0);
  			}
		}

		/* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ */
		#menu-bar {
  				display: flex;
  				gap: 12px;
  				justify-content: center;
  				align-items: center;
  				padding: 10px;
  				background: rgba(0,0,0,0.5);
  				border-radius: 12px;
  				/*position: fixed;*/
  				/*bottom: 20px;*/
  				/*left: 50%;
  				transform: translateX(-50%);*/
  				opacity: 0;
  				transition: opacity 1s ease;
					position: relative;   /* fixed ãƒ» absolute ã‚’ã‚„ã‚ã‚‹ */
  				width: fit-content;   /* ä¸­èº«ã«åˆã‚ã›ã‚‹ */
					margin: 20px auto 0;  /* ä¸­å¤®å¯„ã› */
  				text-align: center;
		}
		#menu-bar.show {
  				opacity: 0.8;
		}
		#menu-bar button {
  				padding: 8px 14px;
  				border: none;
  				border-radius: 8px;
  				background: #fff;
  				font-size: 1em;
  				cursor: pointer;
					-webkit-tap-highlight-color: transparent;
		}
		/* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆç”¨ */
		.fade-out {
  				opacity: 0;
  				transition: opacity 1s;
		}

		/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã€€*/
		@media (max-width: 600px) {
  		.grid {
    			grid-template-columns: repeat(4, 65px);/*4,54*/
    			gap: 12px;/*8*/
  		}
  		.bubble {
    			width: 65px;
    			height: 65px; /* 54 æ­£æ–¹å½¢ã‚’ç¶­æŒ */
  		}
		}

  </style>
</head>
<body>
  <div class="grid" id="grid"></div>
  <div id="message"></div>

	<div id="menu-bar">
  <button id="restart-btn">â†» ã‚‚ã†ä¸€å›ï¼</button>
  <button id="menu-btn">âŒ‚ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸</button>
	</div>

  <!-- åŠ¹æœéŸ³ãƒ•ã‚¡ã‚¤ãƒ« -->
  <audio id="pop-sound" src="Water_01.mp3"></audio>
	<audio id="special-sound" src="Water_02.mp3"></audio>
	<audio id="final-sound" src="Water_High.mp3"></audio>

  <script>
    const grid = document.getElementById('grid');
    const message = document.getElementById('message');
    const sound = document.getElementById('pop-sound');
		const specialSound = document.getElementById('special-sound');
		const finalSound = document.getElementById('final-sound');
		const totalBubbles = 16;

		const restartBtn = document.getElementById("restart-btn");
		const menuBtn = document.getElementById("menu-btn");

		const events = ["click", "touchend"];
		// restartBtn ã«å¯¾ã—ã¦
		events.forEach(evt => {
  		restartBtn.addEventListener(evt, () => window.location.reload());
			});
		// menuBtn ã«å¯¾ã—ã¦
		events.forEach(evt => {
  		menuBtn.addEventListener(evt, () => window.location.href = "index.html");
			});

		const images = ["mitsuba.png", "shiro.png", "lady.png"];
		const fourLeaf = "yotsuba.png";
		const bubbles = [];
		// å¤œã®æ¿ƒç´ºï¼ˆCSSã¨ä¸€è‡´ã•ã›ã‚‹ï¼‰
		const startTop    = { r: 0,  g: 16,  b: 40 };  // #001028
		const startBottom = { r: 0,  g: 51,  b: 77 };  // #00334d

		let currentTop    = { ...startTop };
		let currentBottom = { ...startBottom };
		// æœã®æ°´è‰²ï¼ˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä¸Šç©ºã¨åœ°å¹³ç·šï¼‰
		const endTop    = { r: 179, g: 229, b: 255 };  // ä¸Šç©ºï¼ˆæ°´è‰²ï¼‰
		const endBottom = { r: 255, g: 255, b: 255 };  // åœ°å¹³ç·šï¼ˆç™½ã«è¿‘ã„ï¼‰

		// ã·ã¡ç”Ÿæˆ
    for (let i = 0; i < totalBubbles; i++) {
      const bubble = document.createElement('div');
      bubble.classList.add('bubble');

			// ãƒ©ãƒ³ãƒ€ãƒ ãªä¸‰ã¤è‘‰ç³»
  		const randomImage = images[Math.floor(Math.random() * images.length)];
  		bubble.style.backgroundImage = `url(${randomImage})`;
  		bubble.style.backgroundSize = "cover";

			// ã‚¯ãƒªãƒƒã‚¯ãƒ»ã‚¿ãƒƒãƒã§æ½°ã‚Œã‚‹å‡¦ç†
  		const popBubble = (e) => {
    		/*if (e.type === 'touchstart') {
      		e.preventDefault(); // ã‚¿ãƒƒãƒ—å¾Œã®clickç™ºç«ã‚’é˜²ã
    		}*/

    		if (!bubble.classList.contains('popped')) {
      		bubble.classList.add('popped');

						// èƒŒæ™¯æ›´æ–°
					updateBackground();

					// å››ã¤è‘‰ãªã‚‰ç‰¹åˆ¥ã‚µã‚¦ãƒ³ãƒ‰
    			if (bubble.classList.contains('four-leaf')) {
      			specialSound.currentTime = 0;
      			specialSound.play();
    				} else {
      			sound.currentTime = 0;
      			sound.play();
    				}
						// ãƒãƒ–ãƒ«ã®ä½ç½®ã«æ°´ã—ã¶ãè¿½åŠ 
    				const rect = bubble.getBoundingClientRect();
    				createSplash(rect.left + rect.width / 2, rect.top + rect.height / 2);

          	checkWin(bubble);
						}
					};

  		bubble.addEventListener('click', popBubble);
  		bubble.addEventListener('touchend', popBubble);
  		grid.appendChild(bubble);
			bubbles.push(bubble);
		}
		// 70%ã®ç¢ºç‡ã§å››ã¤è‘‰ã‚’ 1å€‹ã ã‘å‡ºã™
		if (Math.random() < 0.70) {
  		const luckyBubble = bubbles[Math.floor(Math.random() * bubbles.length)];
  		luckyBubble.style.backgroundImage = `url(${fourLeaf})`;
  		luckyBubble.classList.add('four-leaf');
		}
		
		// ã‚°ãƒªãƒƒãƒ‰ä¸Šã®éš£æ¥ã™ã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿”ã™é–¢æ•°
		function getNeighbors(index, cols, total) {
  		const neighbors = [index]; // è‡ªåˆ†
			// å·¦ï¼ˆå·¦ç«¯ã˜ã‚ƒãªã‘ã‚Œã°ï¼‰
  		if (index % cols !== 0) {
    			neighbors.push(index - 1);
  		}
			// å³ï¼ˆå³ç«¯ã˜ã‚ƒãªã‘ã‚Œã°ï¼‰
  		if (index % cols !== cols - 1) {
    			neighbors.push(index + 1);
  		}
			// ä¸Šï¼ˆç¯„å›²å†…ãªã‚‰ï¼‰
  		if (index - cols >= 0) {
    			neighbors.push(index - cols);
  		}
			// ä¸‹ï¼ˆç¯„å›²å†…ãªã‚‰ï¼‰
  		if (index + cols < total) {
    			neighbors.push(index + cols);
  		}
			return neighbors;
		}

		//æœ€å¾Œã®ã‚­ãƒ©ãƒƒã‚’å‡ºã™
		function checkWin(lastBubble) {
			const popped = bubbles.every(b => b.classList.contains('popped'));
  		if (popped) {
    		message.textContent = "æœéœ²ã€ãã‚‰ã‚Šãƒ¼ã‚“ï¼âœ¨";
			// æœ€å¾Œã®éŸ³ã‚’å†ç”Ÿ
    		finalSound.currentTime = 0;
    		finalSound.play();
    	// æœ€å¾Œã«æŠ¼ã—ãŸãƒãƒ–ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—
				const index = bubbles.indexOf(lastBubble);
    		const cols = 4; // ã‚°ãƒªãƒƒãƒ‰åˆ—æ•°ï¼ˆCSSã¨åˆã‚ã›ã‚‹ï¼‰
				const totalBubbles = bubbles.length;
				const neighbors = getNeighbors(index, cols, totalBubbles);

				for (const i of neighbors) {
  				if (i >= 0 && i < totalBubbles) {
    					const bubble = bubbles[i];          
    					const rect = bubble.getBoundingClientRect();
    					createShine(rect.left + rect.width / 2, rect.top + rect.height / 2);
  				}
				}
				// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¶ˆã—ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã‚’å‡ºã™
    		setTimeout(() => {
      		message.classList.add("fade-out");
      	setTimeout(() => {
        	document.getElementById("menu-bar").classList.add("show");
      		}, 1000);
    		}, 3000);		
 	 		}
		}

		function createSplash(x, y) {
  		for (let i = 0; i < 5; i++) { // 5ç²’ãã‚‰ã„é£›ã°ã™
    		const splash = document.createElement("div");
    		splash.classList.add("splash");

				// ç²’ã®å¤§ãã•ï¼šå¤§ãã‚ï¼ˆ8pxã€œ18pxï¼‰
    		const size = 8 + Math.random() * 10;
    		splash.style.width = size + "px";
    		splash.style.height = size + "px";

    		// ãƒ©ãƒ³ãƒ€ãƒ æ–¹å‘ã¨è·é›¢ï¼šé ãã¾ã§ï¼ˆ80ã€œ150pxï¼‰
    		const angle = Math.random() * 2 * Math.PI;
    		const distance = 80 + Math.random() * 70; //é ãã¾ã§
    		const dx = Math.cos(angle) * distance + "px";
    		const dy = Math.sin(angle) * distance + "px";

    		splash.style.setProperty("--x", dx);
    		splash.style.setProperty("--y", dy);
    		splash.style.left = x + "px";
    		splash.style.top = y + "px";

    		document.body.appendChild(splash);
				// ã‚¢ãƒ‹ãƒ¡å¾Œã«å‰Šé™¤
    		splash.addEventListener("animationend", () => splash.remove());
  		}
		}

		function updateBackground() {
			const poppedCount = bubbles.filter(b => b.classList.contains('popped')).length;
  		const ratio = poppedCount / bubbles.length;

  		const targetTop = {
    		r: startTop.r + (endTop.r - startTop.r) * ratio,
    		g: startTop.g + (endTop.g - startTop.g) * ratio,
    		b: startTop.b + (endTop.b - startTop.b) * ratio
  		};

  		const targetBottom = {
    		r: startBottom.r + (endBottom.r - startBottom.r) * ratio,
    		g: startBottom.g + (endBottom.g - startBottom.g) * ratio,
    		b: startBottom.b + (endBottom.b - startBottom.b) * ratio
  		};

  		function animate() {
    	// å°‘ã—ãšã¤è¿‘ã¥ã‘ã‚‹
    		currentTop.r    += (targetTop.r - currentTop.r) * 0.05;
    		currentTop.g    += (targetTop.g - currentTop.g) * 0.05;
    		currentTop.b    += (targetTop.b - currentTop.b) * 0.05;

    		currentBottom.r += (targetBottom.r - currentBottom.r) * 0.05;
    		currentBottom.g += (targetBottom.g - currentBottom.g) * 0.05;
    		currentBottom.b += (targetBottom.b - currentBottom.b) * 0.05;

    	// èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«åæ˜ 
    		document.body.style.background =
      		`	linear-gradient(to bottom, rgb(${Math.round(currentTop.r)},${Math.round(currentTop.g)},${Math.round(currentTop.b)}), 
                        rgb(${Math.round(currentBottom.r)},${Math.round(currentBottom.g)},${Math.round(currentBottom.b)}))`;

    	// ã¾ã å·®ãŒã‚ã‚Œã°ç¶™ç¶š
    		if (Math.abs(targetTop.r - currentTop.r) > 1 ||
        	Math.abs(targetTop.g - currentTop.g) > 1 ||
        	Math.abs(targetTop.b - currentTop.b) > 1 ||
        	Math.abs(targetBottom.r - currentBottom.r) > 1 ||
        	Math.abs(targetBottom.g - currentBottom.g) > 1 ||
        	Math.abs(targetBottom.b - currentBottom.b) > 1) {
      	requestAnimationFrame(animate);
    		}
  		}
  		requestAnimationFrame(animate);
		}
		//æœ€å¾Œã®ã‚­ãƒ©ãƒƒä½œæˆ
		function createShine(x, y) {
  		const shine = document.createElement("div");
  		shine.classList.add("shine");
  		shine.style.left = `${x - 15}px`; // ä¸­å¿ƒã‚’åˆã‚ã›ã‚‹
  		shine.style.top = `${y - 15}px`;
  		document.body.appendChild(shine);

  		shine.addEventListener("animationend", () => shine.remove());
		}

  </script>
<footer style="text-align:center; margin-top:40px; padding:10px; font-size:0.9em; color:#aaa;">
  &copy; 2025 Choco's clover<span style="opacity:0.5;">ğŸ€</span>
</footer>
</body>
</html>